---
title: "Loan Initialization"
description: "Opening positions, depositing collateral, and borrowing against tokenized assets"
---

Loan initialization begins with opening a position—creating an on-chain record that tracks collateral deposits, borrowed amounts, and interest accrual. Users then deposit tokenized assets as collateral and borrow USDC against their locked holdings.

## Opening Positions

Every borrower needs a position before depositing collateral. Positions act as isolated accounts within the lending market, tracking all activity for a specific borrower independently.

<CodeGroup>
```typescript Open Position via API
// POST https://api.trusset.org/v1/lending/positions/open

const response = await fetch('https://api.trusset.org/v1/lending/positions/open', {
  method: 'POST',
  headers: {
    'Authorization': `Bearer ${API_KEY}`,
    'Content-Type': 'application/json'
  },
  body: JSON.stringify({
    marketAddress: "0xLendingMarket"
  })
});

const { positionId } = await response.json();
// positionId: 42
```

```typescript Open Position via SDK
// Direct contract interaction
const tx = await lendingMarket.openPosition();
const receipt = await tx.wait();

const positionId = receipt.events
    .find(e => e.event === 'PositionOpened')
    .args.positionId;

console.log(`Position ${positionId} opened`);
```
</CodeGroup>

Position creation costs minimal gas since it only creates storage entries without transferring tokens. Users can open positions proactively or as part of their first collateral deposit transaction.

## Depositing Collateral

Transfer tokenized assets to the lending market as collateral. The market validates token acceptance, checks for freeze status, and calculates borrowing capacity based on configured collateral factors.

<Accordion title="Collateral Requirements">
Before depositing, ensure:

**Token Approval:** Grant lending market permission to transfer tokens from your wallet. Without approval, deposit transactions revert.

**Minimum Amounts:** Some markets enforce minimum collateral values (typically $1,000-5,000) to prevent dust positions that complicate liquidations.

**Accepted Collateral:** Verify the market accepts your token type. Not all tokenized assets from an institution automatically qualify as collateral.

**Compliance Status:** If tokens have KYC requirements or transfer restrictions, ensure your address meets all criteria before depositing.

**No Freeze Status:** Tokens with issuer-imposed freeze status cannot deposit as collateral until freeze lifts.
</Accordion>

<CodeGroup>
```typescript Deposit Single Collateral
// POST https://api.trusset.org/v1/lending/collateral/deposit

await fetch('https://api.trusset.org/v1/lending/collateral/deposit', {
  method: 'POST',
  body: JSON.stringify({
    positionId: 42,
    tokenAddress: "0xGoldToken",
    amount: "100000000000000000000", // 100 tokens (18 decimals)
    approveFirst: true // Automatically approve if needed
  })
});

// Contract calculates:
// - Token value: 100 tokens × $200/token = $20,000
// - Collateral factor: 75%
// - Borrowing capacity: $15,000
```

```typescript Deposit Multiple Collateral Types
// Deposit diversified collateral in one transaction
await fetch('https://api.trusset.org/v1/lending/collateral/deposit-batch', {
  method: 'POST',
  body: JSON.stringify({
    positionId: 42,
    deposits: [
      {
        tokenAddress: "0xGoldToken",
        amount: "50000000000000000000" // 50 tokens
      },
      {
        tokenAddress: "0xSilverToken",  
        amount: "1000000000000000000000" // 1000 tokens
      }
    ]
  })
});
```
</CodeGroup>

Collateral deposits increase your position's borrowing capacity immediately. The market recalculates health factors and available borrowing amounts after each deposit.

## Calculating Borrowing Capacity

The market determines maximum borrowable amounts by multiplying collateral value by collateral factors:

```typescript
// Borrowing capacity calculation
const goldValue = 50 tokens × $200/token = $10,000
const goldCapacity = $10,000 × 0.75 = $7,500

const silverValue = 1000 tokens × $25/token = $25,000
const silverCapacity = $25,000 × 0.70 = $17,500

const totalCapacity = $7,500 + $17,500 = $25,000
```

You can borrow up to your total capacity, though borrowing the full amount immediately places your position at maximum LTV, leaving no buffer before liquidation threshold.

## Borrowing

Request USDC loans against your deposited collateral. The market validates sufficient borrowing capacity, checks available liquidity, and transfers USDC to your wallet instantly.

<Tabs>
    <Tab title="Standard Borrow">
        Borrow any amount up to your available capacity:

        ```typescript
        // POST https://api.trusset.org/v1/lending/borrow

        await fetch('https://api.trusset.org/v1/lending/borrow', {
          method: 'POST',
          body: JSON.stringify({
            positionId: 42,
            amount: "15000000000", // 15,000 USDC (6 decimals)
            maxSlippage: 0 // No slippage on loan disbursement
          })
        });

        // After borrowing:
        // - Position LTV: 60% ($15k debt / $25k collateral)
        // - Interest begins accruing immediately
        // - Health factor: 1.33 (liquidation at 1.0)
        ```
    </Tab>
    
    <Tab title="Maximum Borrow">
        Calculate and borrow your full available capacity:

        ```typescript
        // GET maximum borrowable amount
        const capacity = await fetch(
          `https://api.trusset.org/v1/lending/positions/${positionId}/capacity`
        ).then(r => r.json());

        // Borrow 95% of capacity leaving safety buffer
        const borrowAmount = capacity.maxBorrow * 0.95;

        await fetch('https://api.trusset.org/v1/lending/borrow', {
          method: 'POST',
          body: JSON.stringify({
            positionId: 42,
            amount: borrowAmount.toString()
          })
        });
        ```
    </Tab>
    
    <Tab title="Incremental Borrowing">
        Borrow small amounts initially, then increase as needed:

        ```typescript
        // Initial conservative borrow
        await lendingMarket.borrow(positionId, "5000000000"); // 5k USDC

        // Check health factor
        const health1 = await lendingMarket.getHealthFactor(positionId);
        // health1 = 5.0 (very safe)

        // Borrow more later
        await lendingMarket.borrow(positionId, "10000000000"); // +10k USDC

        // Updated health factor
        const health2 = await lendingMarket.getHealthFactor(positionId);
        // health2 = 1.67 (still healthy)
        ```
    </Tab>
</Tabs>

<Warning>
Borrowing requires sufficient market liquidity. If total liquidity minus existing borrows falls below your requested amount, the transaction reverts. Monitor market utilization before initiating large borrows.
</Warning>

## Interest Accrual

Interest begins accumulating immediately upon borrowing. The market calculates interest based on current utilization rates, applying a continuously compounding formula.

| Time Period | Interest Calculation | Example (8% APR) |
|-------------|---------------------|------------------|
| Daily | Principal × APR / 365 | $15,000 × 0.08 / 365 = $3.29 |
| Monthly | Principal × APR / 12 | $15,000 × 0.08 / 12 = $100 |
| Yearly | Principal × APR | $15,000 × 0.08 = $1,200 |

Interest rates adjust dynamically based on market utilization. High utilization increases rates, incentivizing repayment and new liquidity provision. Low utilization decreases rates, encouraging additional borrowing.

## Position Monitoring

Track your position health and borrowing capacity in real-time through API queries or dashboard interfaces.

<ResponseField name="borrowedAmount" type="uint256">
  Current principal owed, excluding accrued interest
</ResponseField>

<ResponseField name="accumulatedInterest" type="uint256">
  Interest accrued since last repayment
</ResponseField>

<ResponseField name="totalDebt" type="uint256">
  Sum of borrowed amount and accumulated interest
</ResponseField>

<ResponseField name="collateralValue" type="uint256">
  Current market value of all deposited collateral
</ResponseField>

<ResponseField name="healthFactor" type="uint256">
  Ratio of collateral value to debt (1e18 = 100%, liquidation at 1.0)
</ResponseField>

<ResponseField name="remainingCapacity" type="uint256">
  Additional borrowing available without exceeding collateral factor
</ResponseField>

Monitor health factors closely—values approaching 1.2 indicate elevated risk requiring collateral addition or debt repayment to avoid liquidation.

<CardGroup cols={2}>
    <Card title="Repayments" icon="money-bill-transfer" href="/new/learn/lending/repayments">
        Paying down debt and withdrawing collateral
    </Card>
    <Card title="Liquidation" icon="triangle-exclamation" href="/new/learn/lending/liquidation">
        What happens when positions become unhealthy
    </Card>
    <Card title="Lending Frameworks" icon="layer-group" href="/new/learn/lending/frameworks">
        Asset-specific collateral parameters
    </Card>
    <Card title="API Reference" icon="code" href="/api-reference/lending/positions">
        Position management endpoints
    </Card>
</CardGroup>