---
title: "Controllers"
description: "Administrative functions for market configuration and risk management"
---

Controllers manage lending market operations including collateral acceptance, interest rate adjustments, liquidation parameters, and emergency interventions. These functions route through timelock governance preventing immediate changes and enabling stakeholder review.

## Market Configuration

<ParamField path="configureCollateral" type="function">
  Set collateral acceptance status and risk parameters for specific token types
</ParamField>

<ParamField path="updateInterestModel" type="function">
  Modify interest rate calculation parameters based on market conditions
</ParamField>

<ParamField path="setLiquidationThreshold" type="function">
  Adjust LTV percentage triggering liquidation for each collateral type
</ParamField>

<ParamField path="updateOracleSource" type="function">
  Change price feed source for collateral valuations
</ParamField>

<ParamField path="setProtocolFeeRate" type="function">
  Configure percentage of interest flowing to insurance fund versus liquidity providers
</ParamField>

## Collateral Management

Configure which tokens qualify as loan collateral and their associated risk parameters. Each collateral type receives independent configuration reflecting its unique characteristics.

<CodeGroup>
```typescript Enable Collateral
// POST https://api.trusset.org/v1/lending/collateral/configure

await fetch('https://api.trusset.org/v1/lending/collateral/configure', {
  method: 'POST',
  headers: {
    'Authorization': `Bearer ${API_KEY}`,
    'Content-Type': 'application/json'
  },
  body: JSON.stringify({
    marketAddress: "0xLendingMarket",
    tokenAddress: "0xGoldToken",
    accepted: true,
    collateralFactor: 7500, // 75% LTV
    liquidationThreshold: 8000, // 80% liquidation trigger
    liquidationPenalty: 500 // 5% liquidator bonus
  })
});
```

```typescript Update Parameters
// PATCH https://api.trusset.org/v1/lending/collateral/update

await fetch('https://api.trusset.org/v1/lending/collateral/update', {
  method: 'PATCH',
  body: JSON.stringify({
    marketAddress: "0xLendingMarket",
    tokenAddress: "0xGoldToken",
    collateralFactor: 7000, // Reduce to 70% due to increased volatility
    liquidationThreshold: 7500 // Tighten liquidation trigger
  })
});
```
</CodeGroup>

Parameter changes apply to new positions immediately while existing positions maintain their original parameters until next collateral deposit or borrowing action. This prevents sudden liquidation cascades from parameter tightening.

<Accordion title="Parameter Selection Guidelines">
Choose collateral parameters based on asset characteristics:

**High Liquidity, Low Volatility (Blue Chip Stocks, Gold):**
- Collateral Factor: 70-75%
- Liquidation Threshold: 80-85%
- Liquidation Penalty: 3-5%

**Moderate Liquidity, Moderate Volatility (Real Estate, Corporate Bonds):**
- Collateral Factor: 60-70%
- Liquidation Threshold: 75-80%
- Liquidation Penalty: 5-7%

**Low Liquidity, High Volatility (Private Equity, Emerging Market Assets):**
- Collateral Factor: 40-60%
- Liquidation Threshold: 65-75%
- Liquidation Penalty: 7-10%

Wider gaps between collateral factor and liquidation threshold provide more safety margin before liquidation triggers. Higher penalties incentivize faster liquidation execution.
</Accordion>

## Interest Rate Management

Adjust interest rate model parameters responding to market conditions, competitive pressures, or utilization patterns.

| Parameter | Description | Typical Range |
|-----------|-------------|---------------|
| Base Rate | Minimum interest when utilization is zero | 0-3% APR |
| Multiplier | Rate increase per utilization percentage | 4-8% APR |
| Jump Multiplier | Steep rate increase above kink point | 50-100% APR |
| Kink | Utilization percentage triggering jump | 70-85% |

Lower base rates attract borrowers during low utilization while higher jump multipliers protect liquidity during capital scarcity. Market administrators tune these parameters balancing borrower demand against lender returns.

## Liquidity Management

<ParamField path="pauseMarket" type="function">
  Halt all new borrows while allowing repaymentsâ€”useful during oracle failures or security incidents
</ParamField>

<ParamField path="resumeMarket" type="function">
  Re-enable borrowing after pause resolution
</ParamField>

<ParamField path="setMinBorrowAmount" type="function">
  Establish minimum loan size preventing dust positions that complicate liquidations
</ParamField>

<ParamField path="updateMaxUtilization" type="function">
  Cap total borrowing as percentage of available liquidity, preserving withdrawal capacity
</ParamField>

Emergency pauses prevent new loans during market disruptions without forcing immediate position closures. Existing borrowers maintain their positions and can repay or add collateral freely.

## Oracle Configuration

Lending markets depend on accurate price feeds for collateral valuation. Configure primary and backup oracle sources ensuring uninterrupted pricing.

<Tabs>
    <Tab title="Trading Pool Oracles">
        Connect to AMM pool contracts for real-time pricing from active trading:

        ```typescript
        await lendingMarket.setOracleSource(
            goldTokenAddress,
            "trading_pool",
            {
                primaryPool: "0xGoldUSDCPool",
                backupPool: "0xGoldUSDCPool2",
                staleness: 300 // Max 5 minutes between updates
            }
        );
        ```

        Trading pool oracles provide continuous price discovery but require active markets with sufficient liquidity.
    </Tab>
    
    <Tab title="Manual Price Feeds">
        Use bank-provided valuations for illiquid assets or during market disruptions:

        ```typescript
        await lendingMarket.setOracleSource(
            realEstateTokenAddress,
            "manual_feed",
            {
                signerAddress: "0xBankPriceFeed",
                updateFrequency: 86400, // Daily updates
                maxStaleness: 604800 // Accept up to 7 days old
            }
        );
        ```

        Manual feeds rely on cryptographically signed price updates from authorized sources, enabling lending against assets without liquid secondary markets.
    </Tab>
    
    <Tab title="Hybrid Configuration">
        Combine pool pricing during normal conditions with manual fallback:

        ```typescript
        await lendingMarket.setOracleSource(
            stockTokenAddress,
            "hybrid",
            {
                preferredSource: "trading_pool",
                fallbackSource: "manual_feed",
                switchThreshold: 600 // Fall back after 10 min staleness
            }
        );
        ```

        Hybrid sources maximize price accuracy while maintaining market availability during trading halts or thin liquidity periods.
    </Tab>
</Tabs>

## Insurance Fund Management

<ParamField path="setInsuranceFund" type="function">
  Connect market to insurance fund contract absorbing bad debt
</ParamField>

<ParamField path="updateProtocolFeeRate" type="function">
  Adjust percentage of interest payments funding insurance reserves
</ParamField>

<ParamField path="withdrawExcessReserves" type="function">
  Remove insurance fund capital exceeding target reserve ratio
</ParamField>

Insurance funds protect markets against rare liquidation failures where collateral value drops so rapidly that liquidators cannot cover full debt amounts. A portion of interest payments (typically 10-25%) flows to insurance reserves continuously.

<Warning>
All controller functions route through TimelockController with minimum delay periods (typically 24-72 hours). Proposed changes must wait for timelock duration before execution, enabling users to exit positions if they disagree with parameter updates.
</Warning>

## Access Control

Multiple administrator roles enable separation of duties for operational security:

**Market Admin:** Configure collateral parameters and interest rates
**Oracle Admin:** Update price feed sources and staleness thresholds
**Emergency Admin:** Execute emergency pauses during security incidents
**Timelock Admin:** Propose and execute governance actions after delay periods

Role separation prevents single administrator compromise from causing maximum damage. Critical functions like oracle updates require multi-signature approval from multiple admins.

## Monitoring & Analytics

<ResponseField name="totalLiquidity" type="uint256">
  Total USDC deposited by liquidity providers
</ResponseField>

<ResponseField name="totalBorrowed" type="uint256">
  Outstanding loan principal across all positions
</ResponseField>

<ResponseField name="utilizationRate" type="uint256">
  Percentage of available liquidity currently borrowed
</ResponseField>

<ResponseField name="currentBorrowRate" type="uint256">
  Annual interest rate for new loans based on utilization
</ResponseField>

<ResponseField name="currentSupplyRate" type="uint256">
  Annual returns for liquidity providers after protocol fees
</ResponseField>

<ResponseField name="totalCollateralValue" type="uint256">
  Aggregate value of all deposited collateral across positions
</ResponseField>

Export market metrics for risk dashboards, regulatory reporting, or public transparency pages. These metrics update continuously as positions open, close, or accrue interest.

<CardGroup cols={2}>
    <Card title="Custom Hooks" icon="webhook" href="/new/learn/lending/hooks">
        Automated execution and liquidation bots
    </Card>
    <Card title="Lending Frameworks" icon="layer-group" href="/new/learn/lending/frameworks">
        Asset-specific implementations
    </Card>
    <Card title="Liquidation Process" icon="triangle-exclamation" href="/new/learn/lending/liquidation">
        How positions liquidate when unhealthy
    </Card>
    <Card title="API Reference" icon="code" href="/api-reference/lending/controllers">
        Administrative endpoint documentation
    </Card>
</CardGroup>