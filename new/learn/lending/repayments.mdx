---
title: "Repayments"
description: "Paying down debt, managing interest, and withdrawing collateral"
---

Repayment reduces outstanding debt, stopping interest accrual on repaid amounts. Pay the minimum to extend your loan, pay extra to reduce principal faster, or pay in full to close your position and withdraw collateral.

## Repayment Mechanics

Every repayment transaction processes interest first, then applies remaining payment to principal. This ensures interest obligations satisfy before reducing the core loan amount.

<CodeGroup>
```typescript Standard Repayment
// POST https://api.trusset.org/v1/lending/repay

await fetch('https://api.trusset.org/v1/lending/repay', {
  method: 'POST',
  headers: {
    'Authorization': `Bearer ${API_KEY}`,
    'Content-Type': 'application/json'
  },
  body: JSON.stringify({
    positionId: 42,
    amount: "5000000000", // 5,000 USDC
    approveFirst: true
  })
});

// Smart contract applies payment:
// 1. Calculate current interest: $150
// 2. Pay interest: $150
// 3. Apply remaining to principal: $4,850
// 4. Update position debt
```

```typescript Query Current Debt
// GET total debt before repaying
const debt = await fetch(
  `https://api.trusset.org/v1/lending/positions/${positionId}/debt`,
  { headers: { 'Authorization': `Bearer ${API_KEY}` } }
).then(r => r.json());

// Returns:
// {
//   borrowedAmount: "15000000000",
//   accumulatedInterest: "150000000",
//   totalDebt: "15150000000"
// }
```
</CodeGroup>

Repayments reduce your LTV ratio and improve health factors, creating additional borrowing capacity or providing safety margin against liquidation.

## Interest Accrual Updates

The lending market recalculates accrued interest before every position interaction—repayments, additional borrows, collateral deposits, or withdrawals. This ensures interest calculations reflect the most current state.

```typescript
// Interest accrual calculation
const timeElapsed = currentTimestamp - lastInterestUpdate
const currentAPR = getMarketAPR(utilizationRate)

const newInterest = (borrowedAmount × currentAPR × timeElapsed) / (365 days × 1e18)
accumulatedInterest += newInterest
lastInterestUpdate = currentTimestamp
```

Interest compounds continuously rather than daily or monthly. A position open for 6 hours accumulates exactly 6/24ths of one day's interest, calculated to the second.

## Repayment Strategies

<Tabs>
    <Tab title="Minimum Payments">
        Pay only accrued interest to maintain your position without reducing principal:

        ```typescript
        // Pay current interest only
        const interest = await lendingMarket.getAccumulatedInterest(positionId);
        await lendingMarket.repay(positionId, interest);

        // After payment:
        // - Principal: unchanged
        // - Accumulated interest: $0
        // - Can borrow additional amount
        ```

        Minimum payments extend loans indefinitely while maintaining access to borrowed capital. Useful for positions you want to keep open long-term.
    </Tab>
    
    <Tab title="Principal Reduction">
        Pay more than interest to reduce principal and lower future interest charges:

        ```typescript
        const debt = await lendingMarket.getTotalDebt(positionId);
        // debt = { principal: 15000, interest: 150 }

        // Pay double the interest amount
        await lendingMarket.repay(positionId, debt.interest * 2);

        // Result:
        // - Interest paid: $150
        // - Principal reduced: $150
        // - New principal: $14,850
        // - Future interest lower due to reduced principal
        ```
    </Tab>
    
    <Tab title="Full Payoff">
        Repay entire debt to close position and withdraw all collateral:

        ```typescript
        // Get exact payoff amount
        const payoff = await fetch(
          `https://api.trusset.org/v1/lending/positions/${positionId}/payoff`
        ).then(r => r.json());

        // Repay full amount
        await fetch('https://api.trusset.org/v1/lending/repay', {
          method: 'POST',
          body: JSON.stringify({
            positionId: 42,
            amount: payoff.totalDebt
          })
        });

        // Position closed, collateral withdrawable
        ```
    </Tab>
</Tabs>

## Overpayment Handling

Paying more than total debt automatically caps repayment at exact debt amount, returning excess USDC to your wallet. You cannot accidentally overpay and lose funds.

<Accordion title="Overpayment Example">
Position has $10,150 total debt ($10,000 principal + $150 interest):

```typescript
// Attempt to repay $15,000
await lendingMarket.repay(positionId, "15000000000");

// Contract behavior:
// 1. Calculate total debt: $10,150
// 2. Accept only $10,150 from user
// 3. Reject transaction if USDC allowance < $10,150
// 4. Return $4,850 to user (or never deduct it)
// 5. Mark position as fully repaid
```

This prevents user errors while ensuring positions close cleanly when final payments process.
</Accordion>

## Collateral Withdrawal

After reducing debt through repayment, withdraw excess collateral to realize gains, rebalance portfolios, or sell assets without closing your entire position.

<CodeGroup>
```typescript Withdraw Collateral
// POST https://api.trusset.org/v1/lending/collateral/withdraw

await fetch('https://api.trusset.org/v1/lending/collateral/withdraw', {
  method: 'POST',
  body: JSON.stringify({
    positionId: 42,
    tokenAddress: "0xGoldToken",
    amount: "25000000000000000000" // 25 tokens
  })
});

// Market validates:
// - New health factor remains > 1.0
// - Position stays above collateral factor requirements
// - Transfer succeeds
```

```typescript Calculate Safe Withdrawal
// GET maximum withdrawable without risking liquidation
const withdrawable = await fetch(
  `https://api.trusset.org/v1/lending/positions/${positionId}/withdrawable?token=0xGoldToken`,
  { headers: { 'Authorization': `Bearer ${API_KEY}` } }
).then(r => r.json());

// Returns maximum amount maintaining 1.1 health factor minimum
// Leaves 10% safety buffer above liquidation threshold
```
</CodeGroup>

Withdrawal requests exceeding safe limits revert on-chain. Always check withdrawable amounts before initiating large collateral removals.

## Partial Position Closure

Close portions of positions by repaying some debt and withdrawing proportional collateral, maintaining remaining position at similar LTV:

```typescript
// Example: Close 50% of position
const currentDebt = await lendingMarket.getTotalDebt(positionId);
const currentCollateral = await lendingMarket.getCollateralAmount(
    positionId, 
    goldTokenAddress
);

// Repay 50% of debt
await lendingMarket.repay(positionId, currentDebt.totalDebt / 2);

// Withdraw 50% of collateral
await lendingMarket.withdrawCollateral(
    positionId,
    goldTokenAddress,
    currentCollateral / 2
);

// Result: Same LTV, half the size
```

This strategy maintains market exposure while reducing position size and interest obligations.

## Interest Distribution

Repaid interest distributes between liquidity providers and the protocol insurance fund:

| Recipient | Allocation | Purpose |
|-----------|-----------|---------|
| Liquidity Providers | 75-90% | Rewards for providing borrowable capital |
| Insurance Fund | 10-25% | Reserves covering rare liquidation failures |

Liquidity provider share accrues automatically to their deposited positions, increasing withdrawal value over time. Insurance fund contributions build reserves protecting all market participants.

## Repayment Tracking

All repayment activity records on-chain with complete payment histories:

<ResponseField name="totalRepaid" type="uint256">
  Cumulative amount repaid since position opening
</ResponseField>

<ResponseField name="interestPaid" type="uint256">
  Total interest paid over position lifetime
</ResponseField>

<ResponseField name="remainingPrincipal" type="uint256">
  Current outstanding principal
</ResponseField>

<ResponseField name="remainingInterest" type="uint256">
  Accrued interest not yet paid
</ResponseField>

<ResponseField name="lastRepaymentTimestamp" type="uint256">
  When most recent repayment occurred
</ResponseField>

Export payment histories for accounting, tax reporting, or loan portfolio analysis through API endpoints or blockchain queries.

<Warning>
Withdrawing collateral while carrying debt increases liquidation risk. Always verify health factors remain above 1.2 after withdrawals to maintain safety buffers. Consider paying down debt before removing collateral.
</Warning>

<CardGroup cols={2}>
    <Card title="Loan Initialization" icon="file-circle-plus" href="/new/learn/lending/loan-initialization">
        Opening positions and borrowing process
    </Card>
    <Card title="Liquidation" icon="triangle-exclamation" href="/new/learn/lending/liquidation">
        What happens when positions become unhealthy
    </Card>
</CardGroup>